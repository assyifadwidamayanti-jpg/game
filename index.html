<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ðŸŽ¯ Tic Tac Toe - Lawan Komputer</title>
  <style>
    /* ---------- Root & Responsive sizing ---------- */
    :root{
      --bg1: #0b1020;
      --bg2: linear-gradient(135deg,#0b1020 0%, #0f1530 50%, #1a0536 100%);
      --neon-blue: #37f0ff;
      --neon-purple: #a84bff;
      --glass: rgba(255,255,255,0.04);
      --card-radius: 18px;
      --gap: min(2.4vmin, 14px);
      --board-size: min(80vmin, 520px);
      --cell-size: calc((var(--board-size) - (var(--gap) * 2))/3);
      --accent-glow: 0 0 18px rgba(163, 77, 255, 0.55), 0 0 40px rgba(55, 240, 255, 0.12);
      --font-sans: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{
      height:100%;
      margin:0;
      font-family:var(--font-sans);
      background: radial-gradient(1000px 600px at 10% 10%, rgba(58,82,155,0.12), transparent),
                  radial-gradient(800px 500px at 90% 90%, rgba(168,75,255,0.06), transparent),
                  var(--bg1);
      color:#e9f3ff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:4vmin;
    }

    /* ---------- App container ---------- */
    .app {
      width: min(96vw, 920px);
      max-width: 960px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border-radius: 20px;
      padding: clamp(16px, 2.4vmin, 28px);
      box-shadow: 0 8px 36px rgba(6,10,20,0.6);
      border: 1px solid rgba(255,255,255,0.03);
      position:relative;
      overflow: visible;
    }

    header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
      margin-bottom:clamp(12px, 2vmin, 18px);
    }
    .title {
      display:flex;
      align-items:center;
      gap:12px;
      font-size: clamp(16px, 3vmin, 22px);
      font-weight:700;
      letter-spacing:0.2px;
    }
    .title .emoji { font-size:1.2em }

    /* sound toggle */
    .controls {
      display:flex;
      align-items:center;
      gap:8px;
    }
    .icon-btn{
      background:transparent;
      border:none;
      color:var(--neon-blue);
      font-size:1.2rem;
      padding:8px;
      border-radius:10px;
      cursor:pointer;
      outline:none;
      transition:transform .12s ease, box-shadow .12s ease;
      box-shadow: none;
    }
    .icon-btn:active{ transform:scale(.96) }
    .icon-btn.on{
      box-shadow: var(--accent-glow);
      color:var(--neon-purple);
    }

    /* main layout */
    .main {
      display:flex;
      gap: clamp(14px, 3vmin, 26px);
      align-items:flex-start;
      flex-wrap:wrap;
    }

    /* board card */
    .board-card{
      width:var(--board-size);
      min-width: calc(var(--board-size));
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:16px;
      padding: clamp(12px, 2vmin, 18px);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:12px;
      border: 1px solid rgba(255,255,255,0.03);
    }

    /* board grid */
    .board {
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:var(--gap);
      width:100%;
      max-width:var(--board-size);
      aspect-ratio:1/1;
      align-items:center;
      justify-items:center;
      padding:calc(var(--gap));
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
      border-radius:12px;
      position:relative;
      box-shadow: var(--accent-glow);
    }

    .cell {
      width:100%;
      height:100%;
      aspect-ratio:1/1;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      border-radius:10px;
      cursor:pointer;
      user-select:none;
      position:relative;
      transition:transform .18s cubic-bezier(.2,.9,.25,1), background .18s;
      font-size: calc(var(--board-size) / 6.6);
      font-weight:800;
      color:transparent;
      -webkit-touch-callout:none;
      -webkit-user-select:none;
      -ms-user-select:none;
    }
    .cell::after{
      content:'';
      position:absolute;
      inset:0;
      border-radius:10px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.03);
      pointer-events:none;
    }
    .cell:hover{ transform: translateY(-6px) scale(1.02); }
    .cell.taken{ cursor:default; transform:none; opacity:0.98; }

    /* mark styles */
    .mark {
      pointer-events:none;
      display:inline-grid;
      place-items:center;
      width:80%;
      height:80%;
      transform:scale(.6);
      transition: transform .36s cubic-bezier(.16,.9,.24,1), color .18s;
      text-shadow: 0 6px 30px rgba(66,0,255,0.06);
    }
    .mark.x {
      color:var(--neon-blue);
      filter: drop-shadow(0 0 10px rgba(55,240,255,0.2));
      transform-origin:center;
    }
    .mark.o {
      color:var(--neon-purple);
      filter: drop-shadow(0 0 10px rgba(168,75,255,0.18));
      transform-origin:center;
    }
    .cell.taken .mark { transform: scale(1); }

    /* result overlay */
    .result {
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none;
    }
    .msg {
      pointer-events:auto;
      background: linear-gradient(90deg, rgba(20,20,35,0.9), rgba(40,10,45,0.85));
      border-radius:14px;
      padding:18px 22px;
      text-align:center;
      box-shadow: var(--accent-glow);
      transform: translateY(-10px) scale(.96);
      opacity:0;
      transition: opacity .4s ease, transform .4s cubic-bezier(.2,.9,.25,1);
      color:#fbfcff;
      border:1px solid rgba(255,255,255,0.04);
      max-width: 86%;
    }
    .msg.show{
      opacity:1;
      transform: translateY(0) scale(1);
    }
    .msg h2{
      margin:0 0 6px 0;
      font-size: clamp(18px, 3.6vmin, 26px);
      letter-spacing:0.6px;
    }
    .msg p{ margin:0; opacity:0.9 }

    /* play again */
    .btn {
      margin-top:10px;
      display:inline-block;
      padding:10px 16px;
      border-radius:12px;
      background: linear-gradient(90deg, var(--neon-blue), var(--neon-purple));
      color:#031022;
      font-weight:700;
      border:none;
      cursor:pointer;
      box-shadow: 0 8px 30px rgba(20,10,60,0.35);
      transition: transform .12s;
    }
    .btn:active{ transform:translateY(2px) }

    /* side info */
    .info {
      flex:1;
      min-width:220px;
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:flex-start;
      justify-content:flex-start;
    }
    .card {
      width:100%;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.03);
      font-size:14px;
    }
    .score {
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:space-between;
      width:100%;
    }
    .score .who{
      display:flex;
      gap:8px;
      align-items:center;
      font-weight:700;
      color:var(--neon-blue);
    }

    /* winning line highlight */
    .win-line {
      position:absolute;
      pointer-events:none;
      inset:0;
    }
    .line {
      position:absolute;
      height:6px;
      background: linear-gradient(90deg, rgba(55,240,255,0.9), rgba(168,75,255,0.95));
      border-radius:8px;
      transform-origin:center;
      box-shadow: 0 0 40px rgba(163,77,255,0.18);
      opacity:0;
      transition: opacity .18s ease, transform .18s ease;
    }
    .line.show{ opacity:1; }

    /* small responsive tweaks */
    @media (max-width:820px){
      .main { gap:12px; }
      .info { order:2; }
      .board-card { order:1; margin:0 auto }
    }

    /* subtle neon pulse for title */
    @keyframes neonPulse {
      0% { text-shadow: 0 0 8px rgba(55,240,255,0.12), 0 0 0 rgba(168,75,255,0); transform: translateY(0) }
      50% { text-shadow: 0 0 18px rgba(55,240,255,0.28), 0 0 36px rgba(168,75,255,0.12); transform: translateY(-2px) }
      100% { text-shadow: 0 0 8px rgba(55,240,255,0.12), 0 0 0 rgba(168,75,255,0); transform: translateY(0) }
    }
    .title span { animation: neonPulse 3.6s ease-in-out infinite; display:inline-block }

    /* fade & glow for draw */
    .draw-glow {
      position:absolute;
      inset:0;
      border-radius:12px;
      box-shadow: inset 0 0 60px rgba(120,100,255,0.06);
      pointer-events:none;
      opacity:0;
      transition: opacity .4s ease;
    }
    .draw-glow.show { opacity:1; }

  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Tic Tac Toe - Lawan Komputer">
    <header>
      <div class="title" aria-hidden="false">
        <span class="emoji">ðŸŽ¯</span>
        <span>Tic Tac Toe - Lawan Komputer</span>
      </div>
      <div class="controls" aria-hidden="false">
        <button id="soundToggle" class="icon-btn on" title="Suara aktif (klik untuk matikan)">ðŸ”Š</button>
      </div>
    </header>

    <main class="main">
      <section class="board-card" aria-label="Papan permainan">
        <div class="board" id="board" role="grid" aria-label="Papan tic tac toe">
          <!-- 9 cells injected by JS -->
        </div>

        <div class="win-line" id="winLine" aria-hidden="true"></div>
        <div class="draw-glow" id="drawGlow" aria-hidden="true"></div>

        <div class="result" id="result">
          <div class="msg" id="msgBox" role="status" aria-live="polite">
            <h2 id="resultTitle">Hasil</h2>
            <p id="resultText"></p>
            <div style="margin-top:12px; display:flex; justify-content:center">
              <button id="playAgain" class="btn" style="display:none">Main Lagi</button>
            </div>
          </div>
        </div>
      </section>

      <aside class="info" aria-label="Informasi permainan">
        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center">
            <div>
              <div style="font-size:13px; opacity:0.9">Giliran</div>
              <div id="turnIndicator" style="font-weight:800; font-size:16px; margin-top:6px; color:var(--neon-blue)">Kamu (X)</div>
            </div>
            <div style="text-align:right">
              <div style="font-size:13px; opacity:0.9">Mode</div>
              <div style="font-weight:800; margin-top:6px;">Komputer (O) - Minimax</div>
            </div>
          </div>
        </div>

        <div class="card score" aria-hidden="false">
          <div>
            <div style="font-size:13px; opacity:0.9">Skor</div>
            <div style="display:flex; gap:10px; margin-top:8px; font-weight:800">
              <div style="color:var(--neon-blue)">Kamu: <span id="scorePlayer">0</span></div>
              <div style="color:var(--neon-purple)">Komputer: <span id="scoreAI">0</span></div>
              <div style="color:#cfe6ff">Seri: <span id="scoreDraw">0</span></div>
            </div>
          </div>
        </div>

        <div class="card" style="display:flex; justify-content:space-between; align-items:center">
          <div style="font-size:13px; opacity:0.9">Pengaturan</div>
          <div>
            <button id="resetScores" class="btn" style="padding:8px 12px; font-weight:700; background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--neon-blue)">Reset Skor</button>
          </div>
        </div>
      </aside>
    </main>
  </div>

  <script>
    /***********************
     * Tic Tac Toe - Single File
     * - Minimax AI
     * - WebAudio for effects + background loop
     * - Responsive neon UI & animations
     ***********************/

    // ---------- DOM Refs ----------
    const boardEl = document.getElementById('board');
    const msgBox = document.getElementById('msgBox');
    const resultTitle = document.getElementById('resultTitle');
    const resultText = document.getElementById('resultText');
    const playAgainBtn = document.getElementById('playAgain');
    const resultWrap = document.getElementById('result');
    const winLineWrap = document.getElementById('winLine');
    const drawGlow = document.getElementById('drawGlow');
    const soundToggle = document.getElementById('soundToggle');
    const turnIndicator = document.getElementById('turnIndicator');
    const scorePlayerEl = document.getElementById('scorePlayer');
    const scoreAIEl = document.getElementById('scoreAI');
    const scoreDrawEl = document.getElementById('scoreDraw');
    const resetScoresBtn = document.getElementById('resetScores');

    // ---------- Game State ----------
    let board = Array(9).fill(null); // null, 'X', 'O'
    let human = 'X', ai = 'O';
    let currentPlayer = human;
    let gameOver = false;

    // scores
    let score = { player:0, ai:0, draw:0 };

    // winning combos
    const wins = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];

    // ---------- Create board cells ----------
    function createBoard(){
      boardEl.innerHTML = '';
      for(let i=0;i<9;i++){
        const cell = document.createElement('button');
        cell.className = 'cell';
        cell.setAttribute('data-index', i);
        cell.setAttribute('role','gridcell');
        cell.setAttribute('aria-label', 'Kotak ' + (i+1));
        cell.addEventListener('click', onCellClick);
        // mark element
        const mark = document.createElement('div');
        mark.className = 'mark';
        cell.appendChild(mark);
        boardEl.appendChild(cell);
      }
    }

    createBoard();

    // ---------- Audio (WebAudio) ----------
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioCtx();
    let masterGain = audioCtx.createGain();
    masterGain.gain.value = 0.88;
    masterGain.connect(audioCtx.destination);

    // background loop nodes
    let bgOsc1, bgOsc2, bgGain;
    let bgPlaying = true;

    function startBackground(){
      stopBackground();
      bgOsc1 = audioCtx.createOscillator();
      bgOsc2 = audioCtx.createOscillator();
      bgGain = audioCtx.createGain();
      bgGain.gain.value = 0.04;
      bgOsc1.type = 'sine';
      bgOsc2.type = 'triangle';
      bgOsc1.frequency.value = 110;
      bgOsc2.frequency.value = 220;
      // slight detune for nice pad
      bgOsc1.detune.value = -12;
      bgOsc2.detune.value = 8;
      bgOsc1.connect(bgGain);
      bgOsc2.connect(bgGain);
      bgGain.connect(masterGain);
      bgOsc1.start();
      bgOsc2.start();

      // gentle filter LFO for motion
      const lfo = audioCtx.createOscillator();
      const lfoGain = audioCtx.createGain();
      lfoGain.gain.value = 30;
      const filter = audioCtx.createBiquadFilter();
      filter.type = 'lowpass';
      filter.frequency.value = 800;
      lfo.connect(lfoGain);
      lfoGain.connect(filter.frequency);
      bgGain.connect(filter);
      filter.connect(masterGain);
      lfo.frequency.value = 0.08;
      lfo.start();

      // keep references to stop later
      bgOsc1._extra = { bgOsc2, bgGain, lfo };
    }
    function stopBackground(){
      if(bgOsc1){
        try{
          bgOsc1._extra.bgOsc2.stop();
          bgOsc1._extra.lfo.stop();
          bgOsc1.stop();
        }catch(e){}
      }
      bgOsc1 = null; bgOsc2 = null;
    }

    // click sound
    function clickSound(){
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = 'square';
      o.frequency.value = 880;
      g.gain.value = 0.0001;
      o.connect(g);
      g.connect(masterGain);
      o.start();
      // envelope
      const now = audioCtx.currentTime;
      g.gain.cancelScheduledValues(now);
      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(0.12, now + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, now + 0.18);
      o.stop(now + 0.22);
    }

    // victory sound
    function victorySound(){
      const now = audioCtx.currentTime;
      const freqs = [660,880,1320];
      freqs.forEach((f,i)=>{
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = 'sine';
        o.frequency.value = f;
        g.gain.value = 0.0001;
        o.connect(g);
        g.connect(masterGain);
        o.start(now + i*0.06);
        g.gain.exponentialRampToValueAtTime(0.12, now + i*0.06 + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, now + i*0.06 + 0.28);
        o.stop(now + i*0.06 + 0.32);
      });
    }

    // try to unlock audio context on first user gesture
    function tryResumeAudio(){
      if(audioCtx.state === 'suspended') {
        audioCtx.resume().catch(()=>{});
      }
    }

    // ---------- UI Helpers ----------
    function setTurnIndicator(p){
      turnIndicator.textContent = (p===human) ? 'Kamu (X)' : 'Komputer (O)';
    }

    function renderBoard(){
      board.forEach((v,i)=>{
        const cell = boardEl.children[i];
        cell.classList.toggle('taken', !!v);
        const mark = cell.querySelector('.mark');
        mark.className = 'mark ' + (v ? v.toLowerCase() : '');
        mark.textContent = v ? v : '';
      });
    }

    // ---------- Game Logic ----------
    function onCellClick(e){
      tryResumeAudio();
      if(gameOver) return;
      const idx = Number(e.currentTarget.dataset.index);
      if(board[idx]) return; // occupied
      clickSound();
      makeMove(idx, human);
    }

    function makeMove(index, player){
      if(gameOver) return;
      if(board[index]) return;
      board[index] = player;
      renderBoard();
      // animate mark scaling (small extra)
      const cell = boardEl.children[index];
      setTimeout(()=> cell.classList.add('taken'), 10);

      const winner = checkWinner(board);
      if(winner){
        endGame(winner);
        return;
      }
      if(isBoardFull(board)){
        endGame('draw');
        return;
      }
      // switch
      currentPlayer = (player === human) ? ai : human;
      setTurnIndicator(currentPlayer);
      if(currentPlayer === ai){
        // short delay then AI move
        setTimeout(()=> {
          const aiIdx = bestMove();
          clickSound();
          makeMove(aiIdx, ai);
        }, 420);
      }
    }

    function checkWinner(bd){
      for(const combo of wins){
        const [a,b,c] = combo;
        if(bd[a] && bd[a] === bd[b] && bd[a] === bd[c]){
          return { winner: bd[a], combo };
        }
      }
      return null;
    }
    function isBoardFull(bd){
      return bd.every(Boolean);
    }

    // ---------- End game handling & animations ----------
    function endGame(result){
      gameOver = true;
      let title = '';
      if(result === 'draw'){
        title = 'Seri!';
        resultTitle.textContent = title;
        resultText.textContent = 'Permainan berakhir seri.';
        score.draw++;
        scoreDrawEl.textContent = score.draw;
        // show draw glow
        drawGlow.classList.add('show');
        setTimeout(()=> drawGlow.classList.remove('show'), 1600);
      } else {
        const who = result.winner;
        if(who === human){
          title = 'Kamu Menang!';
          score.player++;
          scorePlayerEl.textContent = score.player;
        } else {
          title = 'Komputer Menang!';
          score.ai++;
          scoreAIEl.textContent = score.ai;
        }
        resultTitle.textContent = title;
        resultText.textContent = (who===human) ? 'Hebat! Kamu berhasil menang atas komputer.' : 'Komputer bermain baik kali ini.';
        // show winning line
        showWinLine(result.combo);
        // sound
        victorySound();
      }

      // show msg
      msgBox.classList.add('show');
      playAgainBtn.style.display = 'inline-block';
      playAgainBtn.focus();
    }

    function showWinLine(combo){
      // compute positions of cells
      const rects = combo.map(i => boardEl.children[i].getBoundingClientRect());
      const boardRect = boardEl.getBoundingClientRect();
      // center points relative to board
      const centers = rects.map(r => ({ x: r.left + r.width/2 - boardRect.left, y: r.top + r.height/2 - boardRect.top }));
      // position the line element
      winLineWrap.innerHTML = '';
      const line = document.createElement('div');
      line.className = 'line';
      // compute angle & length
      const dx = centers[2].x - centers[0].x;
      const dy = centers[2].y - centers[0].y;
      const len = Math.hypot(dx, dy);
      const angle = Math.atan2(dy, dx) * (180/Math.PI);
      line.style.width = len + 'px';
      line.style.left = (centers[0].x + centers[2].x)/2 - (len/2) + 'px';
      line.style.top = (centers[0].y + centers[2].y)/2 - 3 + 'px';
      line.style.transform = 'rotate(' + angle + 'deg)';
      winLineWrap.appendChild(line);
      // show with animation
      setTimeout(()=> line.classList.add('show'), 30);
      // fade out after a while
      setTimeout(()=> {
        if(line) line.classList.remove('show');
      }, 1800);
    }

    // ---------- Play again & reset ----------
    playAgainBtn.addEventListener('click', resetRound);
    function resetRound(){
      board = Array(9).fill(null);
      gameOver = false;
      currentPlayer = human;
      setTurnIndicator(currentPlayer);
      msgBox.classList.remove('show');
      playAgainBtn.style.display = 'none';
      winLineWrap.innerHTML = '';
      renderBoard();
    }

    resetScoresBtn.addEventListener('click', ()=>{
      score = { player:0, ai:0, draw:0 };
      scorePlayerEl.textContent = 0;
      scoreAIEl.textContent = 0;
      scoreDrawEl.textContent = 0;
    });

    // ---------- Minimax AI ----------
    function bestMove(){
      // AI chooses the index maximizing its chance
      const best = minimax(board.slice(), ai);
      return best.index;
    }

    function minimax(newBoard, playerTurn){
      // available spots
      const avail = newBoard.map((v,i)=> v ? null : i).filter(v=>v!==null);

      // terminal checks
      const winCheck = checkWinner(newBoard);
      if(winCheck){
        if(winCheck.winner === ai) return { score: +10 };
        else if(winCheck.winner === human) return { score: -10 };
      }
      if(avail.length === 0) return { score: 0 };

      // store moves
      const moves = [];

      for(const i of avail){
        const move = {};
        move.index = i;
        newBoard[i] = playerTurn;

        if(playerTurn === ai){
          const result = minimax(newBoard, human);
          move.score = result.score;
        } else {
          const result = minimax(newBoard, ai);
          move.score = result.score;
        }

        // reset spot
        newBoard[i] = null;
        moves.push(move);
      }

      // choose best move
      let bestMoveIndex;
      if(playerTurn === ai){
        let bestScore = -Infinity;
        for(let i=0;i<moves.length;i++){
          if(moves[i].score > bestScore){
            bestScore = moves[i].score;
            bestMoveIndex = i;
          }
        }
      } else {
        // human tries to minimize
        let bestScore = +Infinity;
        for(let i=0;i<moves.length;i++){
          if(moves[i].score < bestScore){
            bestScore = moves[i].score;
            bestMoveIndex = i;
          }
        }
      }

      return moves[bestMoveIndex];
    }

    // ---------- Initial render & autoplay attempt ----------
    renderBoard();
    setTurnIndicator(currentPlayer);

    // attempt to autoplay music (may be blocked until user interacts)
    function toggleAudio(on){
      if(on){
        soundToggle.classList.add('on');
        soundToggle.textContent = 'ðŸ”Š';
        startBackground();
        bgPlaying = true;
      } else {
        soundToggle.classList.remove('on');
        soundToggle.textContent = 'ðŸ”‡';
        stopBackground();
        bgPlaying = false;
      }
    }

    // ensure first user gesture resumes audio context
    soundToggle.addEventListener('click', ()=>{
      tryResumeAudio();
      toggleAudio(!bgPlaying);
      soundToggle.blur();
    });

    // unlock audio on any app click if suspended
    document.addEventListener('pointerdown', () => {
      tryResumeAudio();
    }, { once: true });

    // try to start background; some browsers block until interaction
    try { startBackground(); } catch(e){ /* ignore */ }

    // make board responsive by setting cell sizes
    function adjustCellSizes(){
      const gap = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--gap')) || 12;
      const b = boardEl.getBoundingClientRect();
      // set font-size of cell marks based on board width (already via CSS using var)
      // Ensure cells are easy to tap: set min size if small screen
      for(const c of boardEl.children){
        c.style.fontSize = Math.max(18, b.width / 6.6) + 'px';
      }
    }
    window.addEventListener('resize', adjustCellSizes);
    setTimeout(adjustCellSizes, 80);

    // ---------- small polishing: keyboard support for accessibility ----------
    boardEl.addEventListener('keydown', (e) => {
      const active = document.activeElement;
      if(!active || !active.classList.contains('
